<!-- Version: #12 -->
<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Mentometer - HOST</title>
    <link rel="stylesheet" href="style.css">
    <!-- PeerJS Library -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <!-- Marked Library -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

    <div class="container">
        <header>
            <h1>GM Kontrollpanel</h1>
            <div id="connection-status">
                <span class="status-indicator status-disconnected" id="status-dot"></span>
                <span id="status-text">Frakoblet</span>
            </div>
            <a href="index.html" style="color: #666; font-size: 0.8rem;">&larr; Tilbake til start</a>
        </header>

        <!-- SEKSJON 1: SETUP (Nå med Scenario-bygger) -->
        <div id="setup-panel" class="card">
            <h2>1. Konfigurasjon</h2>
            
            <label for="api-key">Gemini API Key:</label>
            <input type="password" id="api-key" placeholder="Lim inn API Key her...">
            
            <label for="model-name">Modellnavn:</label>
            <input type="text" id="model-name" value="gemini-1.5-flash-002" placeholder="F.eks. gemini-1.5-flash">

            <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">

            <h2>2. Design Eventyret</h2>
            <p style="font-size: 0.9rem; color: #aaa;">Her bestemmer du reglene og verdenen. Jo mer detaljert, jo bedre intro.</p>
            
            <label for="game-premise">Premiss / Verden / Regler:</label>
            <textarea id="game-premise" rows="6" placeholder="F.eks:
Sjanger: High Fantasy (D&D stil).
Spillerne er: En gruppe uerfarne eventyrere (Kriger, Tyv, Trollmann).
Setting: De våkner i et fangehull uten minner.
Tone: Humoristisk men farlig.
Mekanikk: Hvis det er kamp, gi oss prosentvis sjanse for å lykkes."></textarea>
            
            <button id="btn-start-hosting" class="btn">Opprett Rom & Generer Intro</button>
        </div>

        <!-- SEKSJON 2: LOBBY -->
        <div id="lobby-panel" class="card hidden">
            <div style="text-align: center;">
                <p>Romkode:</p>
                <div id="room-code-display" style="font-size: 3rem; font-weight: bold; color: var(--secondary-color); letter-spacing: 5px;">----</div>
                <div style="margin-top: 10px;">
                    <span id="player-count">0</span> spillere tilkoblet
                </div>
            </div>
            <!-- Skjult liste for å spare plass, vises ved behov -->
            <details style="margin-top: 10px; cursor: pointer; color: #888;">
                <summary>Vis spillerliste</summary>
                <ul id="player-list" style="list-style: none; padding: 10px; background: #1a1a1a;"></ul>
            </details>
        </div>

        <!-- SEKSJON 3: STORY DISPLAY -->
        <div id="game-panel" class="card hidden">
            <h2>Historien</h2>
            
            <!-- Her kommer teksten fra Gemini -->
            <div id="current-narrative" style="background: #252525; padding: 20px; border-radius: 5px; margin-bottom: 20px; line-height: 1.6;">
                <em style="color: #888;">Genererer introduksjon...</em>
            </div>

            <!-- Stemmeresultater -->
            <h3>Stemmer</h3>
            <div id="voting-results" class="results-container"></div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="btn-lock-voting" class="btn btn-secondary">Lås Stemming</button>
            </div>
        </div>

        <!-- SEKSJON 4: GM INPUT (Neste runde) -->
        <div id="gm-input-panel" class="card hidden">
            <h2>Game Master Input</h2>
            <p style="font-size: 0.8rem; color: #aaa;">Juster hva som skjedde, eller legg til egne ideer før neste generering.</p>
            
            <label for="scenario-context">Kontekst for neste kapittel:</label>
            <textarea id="scenario-context" rows="3"></textarea>

            <div style="margin: 10px 0;">
                <label style="display: inline-flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="chk-custom-option" style="width: auto; margin: 0 10px 0 0;">
                    Inkluder valg for "Eget forslag fra klassen"
                </label>
            </div>

            <button id="btn-generate" class="btn">Generer Neste Kapittel</button>
        </div>

        <!-- DEBUG LOG -->
        <div class="card">
            <h3 style="cursor: pointer; font-size: 0.8rem;" onclick="document.getElementById('debug-log').classList.toggle('hidden')">System Logg &#9660;</h3>
            <div id="debug-log" class="hidden" style="font-family: monospace; font-size: 0.7rem; color: #0f0; background: #000; padding: 10px; height: 100px; overflow-y: scroll;"></div>
        </div>

    </div>

    <script src="host.js"></script>
    <script>
        function logToUi(msg) {
            const logEl = document.getElementById('debug-log');
            if(logEl) {
                const entry = document.createElement('div');
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
                logEl.appendChild(entry);
                logEl.scrollTop = logEl.scrollHeight;
            }
            console.log(`[HOST] ${msg}`);
        }
        logToUi("host.html v12 lastet.");
    </script>
</body>
</html>
<!-- Version: #12 -->
